@page "/hotel/rooms"
@using System.Globalization
@inject ILocalStorageService localStorage
@inject IJSRuntime jsRuntime
@inject IHotelRoomsService hotelRoomsService

<h3>HotelRooms</h3>

@code {
	private HomeVM HomeModel { get; set; } = new HomeVM();

	public IEnumerable<HotelRoomDTO> Rooms { get; set; } = new List<HotelRoomDTO>();

	protected override async Task OnInitializedAsync()
	{
		await Task.Delay(5000);

		try
		{
			if(await localStorage.GetItemAsync<HomeVM>(SD.Local_InitialBooking) is { } home)
			{
				HomeModel = home;
			}
			else
			{
				HomeModel.NoOfNights = 1;
			}
			await LoadRooms();
		}
		catch(Exception e)
		{
			await jsRuntime.ToastrError(e.Message);
		}
	}

	private async Task LoadRooms()
	{
		var start = HomeModel.StartData.ToString("MM/dd/yyyy", CultureInfo.InvariantCulture);
		var end = HomeModel.EndDate.ToString("MM/dd/yyyy", CultureInfo.InvariantCulture);
		Rooms = await hotelRoomsService.GetHotelRooms(start, end);
	}
}
